--// Load Rayfield UI
local Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/SiriusSoftwareLtd/Rayfield/main/source.lua'))()

--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local root = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")

-- Table lưu dot
local pathPoints = {}
local lastDotTime = 0
local dotCooldown = 0.5

-- Default settings
_G.AutoWalkAFK = true
_G.DistanceThreshold = 5
_G.AutoMove = true
_G.MoveSpeed = humanoid.WalkSpeed

-- Function thêm dot hình tròn, dẹp dưới chân player
local function addDot(position)
    local dot = Instance.new("Part")
    dot.Name = "Dot"
    dot.Shape = Enum.PartType.Ball -- tròn
    dot.Size = Vector3.new(1,0.2,1) -- dẹp lép
    dot.Position = Vector3.new(position.X, position.Y - root.Size.Y/2, position.Z)
    dot.Anchored = true
    dot.CanCollide = false
    dot.Transparency = 0.5
    dot.BrickColor = BrickColor.new("Bright red")
    dot.Material = Enum.Material.Neon -- nhìn nổi bật hơn
    dot.LocalTransparencyModifier = 0
    dot.Parent = workspace
    table.insert(pathPoints, dot)
end

-- Auto spawn dot theo player
RunService.RenderStepped:Connect(function()
    if _G.AutoWalkAFK then
        if tick() - lastDotTime >= dotCooldown then
            local lastPos = #pathPoints > 0 and pathPoints[#pathPoints].Position or nil
            if not lastPos or (root.Position - lastPos).Magnitude > _G.DistanceThreshold then
                addDot(root.Position)
                lastDotTime = tick()
            end
        end
    end
end)

-- Hàm smooth movement (cong cong)
local function getSmoothDirection(startPos, endPos)
    local randomOffset = Vector3.new(
        math.random(-2,2), 
        0, 
        math.random(-2,2)
    )
    return (endPos + randomOffset - startPos).Unit
end

-- Auto move player theo dot cong cong
RunService.Heartbeat:Connect(function(delta)
    if _G.AutoWalkAFK and _G.AutoMove and #pathPoints > 0 then
        local targetDot = pathPoints[1]
        local distance = (targetDot.Position - root.Position).Magnitude
        if distance > 1 then
            local direction = getSmoothDirection(root.Position, targetDot.Position)
            local randomCurve = Vector3.new(
                math.sin(tick()*2)*0.5,
                0,
                math.cos(tick()*2)*0.5
            )
            humanoid:Move((direction + randomCurve).Unit * _G.MoveSpeed * delta)
        else
            targetDot:Destroy()
            table.remove(pathPoints,1)
        end
    end
end)

-- Khi hết dot → dance + jump + spawn dot lại
RunService.Heartbeat:Connect(function()
    if _G.AutoWalkAFK and #pathPoints == 0 then
        local danceId = math.random(1,4)
        print("/e dance "..danceId)
        humanoid.Jump = true
        addDot(root.Position)
    end
end)

--// Rayfield Window UI
local Window = Rayfield:CreateWindow({
    Name = "Player AFK AutoWalk + Dance",
    LoadingTitle = "Loading...",
    LoadingSubtitle = "Red GPT Script",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "RedScripts",
        FileName = "PlayerAFKAutoWalk"
    }
})

local Tab = Window:CreateTab("Main", 4483362458)

-- Toggle Auto Walk AFK
Tab:CreateToggle({
    Name = "Auto Walk AFK",
    CurrentValue = _G.AutoWalkAFK,
    Flag = "AFKToggle",
    Callback = function(value)
        _G.AutoWalkAFK = value
        if not value then
            for _, dot in pairs(Workspace:GetChildren()) do
                if dot.Name == "Dot" then dot:Destroy() end
            end
            pathPoints = {}
        end
    end
})

-- Toggle Auto Move
Tab:CreateToggle({
    Name = "Auto Move Player",
    CurrentValue = _G.AutoMove,
    Flag = "MoveToggle",
    Callback = function(value)
        _G.AutoMove = value
    end
})

-- Slider khoảng cách spawn dot
Tab:CreateSlider({
    Name = "Distance Threshold",
    Range = {1, 20},
    Increment = 1,
    Suffix = "stud",
    CurrentValue = _G.DistanceThreshold,
    Flag = "DistanceSlider",
    Callback = function(value)
        _G.DistanceThreshold = value
    end
})

-- Button clear dot thủ công
Tab:CreateButton({
    Name = "Clear All Dots",
    Callback = function()
        for _, dot in pairs(Workspace:GetChildren()) do
            if dot.Name == "Dot" then dot:Destroy() end
        end
        pathPoints = {}
    end
})