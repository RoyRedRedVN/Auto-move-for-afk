-- LocalScript trong StarterPlayerScripts
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- Default settings
local WALK_RADIUS = 50
local COOLDOWN = 2
local autoWalkEnabled = true
local autoJumpWhenSit = true

-- UI setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AutoWalkUI"
screenGui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 220, 0, 190)
frame.Position = UDim2.new(0, 20, 0, 200)
frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
frame.BackgroundTransparency = 0.2

-- Toggle AutoWalk
local toggleBtn = Instance.new("TextButton", frame)
toggleBtn.Size = UDim2.new(1, -20, 0, 30)
toggleBtn.Position = UDim2.new(0, 10, 0, 10)
toggleBtn.Text = "AutoWalk: ON"

toggleBtn.MouseButton1Click:Connect(function()
	autoWalkEnabled = not autoWalkEnabled
	toggleBtn.Text = "AutoWalk: " .. (autoWalkEnabled and "ON" or "OFF")
end)

-- Walk radius box
local radiusBox = Instance.new("TextBox", frame)
radiusBox.Size = UDim2.new(1, -20, 0, 30)
radiusBox.Position = UDim2.new(0, 10, 0, 50)
radiusBox.PlaceholderText = "Walk Radius ("..WALK_RADIUS..")"
radiusBox.Text = ""

radiusBox.FocusLost:Connect(function()
	local val = tonumber(radiusBox.Text)
	if val then
		WALK_RADIUS = val
		radiusBox.PlaceholderText = "Walk Radius ("..WALK_RADIUS..")"
	end
	radiusBox.Text = ""
end)

-- Cooldown box
local cooldownBox = Instance.new("TextBox", frame)
cooldownBox.Size = UDim2.new(1, -20, 0, 30)
cooldownBox.Position = UDim2.new(0, 10, 0, 90)
cooldownBox.PlaceholderText = "Cooldown ("..COOLDOWN.."s)"
cooldownBox.Text = ""

cooldownBox.FocusLost:Connect(function()
	local val = tonumber(cooldownBox.Text)
	if val then
		COOLDOWN = val
		cooldownBox.PlaceholderText = "Cooldown ("..COOLDOWN.."s)"
	end
	cooldownBox.Text = ""
end)

-- Toggle AutoJumpWhenSit
local jumpBtn = Instance.new("TextButton", frame)
jumpBtn.Size = UDim2.new(1, -20, 0, 30)
jumpBtn.Position = UDim2.new(0, 10, 0, 130)
jumpBtn.Text = "AutoJumpWhenSit: ON"

jumpBtn.MouseButton1Click:Connect(function()
	autoJumpWhenSit = not autoJumpWhenSit
	jumpBtn.Text = "AutoJumpWhenSit: " .. (autoJumpWhenSit and "ON" or "OFF")
end)

-- lưu humanoid + root mỗi lần respawn
local humanoid, root

local function setupCharacter(character)
	humanoid = character:WaitForChild("Humanoid")
	root = character:WaitForChild("HumanoidRootPart")

	-- Auto jump when sit
	humanoid:GetPropertyChangedSignal("Sit"):Connect(function()
		if autoJumpWhenSit and humanoid.Sit then
			print("⚠️ Player Sit → auto jump")
			if humanoid.SeatPart then
				humanoid.Sit = false
			end
			humanoid.Jump = true
		end
	end)
end

setupCharacter(player.Character or player.CharacterAdded:Wait())
player.CharacterAdded:Connect(setupCharacter)

-- Random point quanh player
local function getRandomPoint()
	local base = root.Position
	local offset = Vector3.new(
		math.random(-WALK_RADIUS, WALK_RADIUS),
		0,
		math.random(-WALK_RADIUS, WALK_RADIUS)
	)
	return base + offset
end

-- Auto walk loop
task.spawn(function()
	while true do
		if autoWalkEnabled and humanoid and root then
			local point = getRandomPoint()
			print("👉 MoveTo:", point)
			humanoid:MoveTo(point)

			-- Timeout nếu MoveTo fail
			local success = false
			local finishedConn
			finishedConn = humanoid.MoveToFinished:Connect(function(reached)
				success = reached
				finishedConn:Disconnect()
			end)

			local t0 = tick()
			repeat task.wait(0.1) until success or tick() - t0 > 5
			if not success then
				print("❌ MoveTo fail → retry sau cooldown")
			end

			task.wait(COOLDOWN)
		else
			task.wait(0.5)
		end
	end
end)