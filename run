-- Load WindUI
local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/Example.lua"))()

-- Variables
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local RootPart = Character:WaitForChild("HumanoidRootPart")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

local autoAFKEnabled = false
local autoAFKAvoidEnabled = false
local autoAvoidEnabled = false
local cooldown = 2
local moveRadius = 30
local avoidDistance = 15
local backDistance = 10
local replyKeywords = {"plss", "pls", "pet", "fruit", "money", "garden"}
local replyText = "no"

-- Create UI Window
local Window = WindUI.new("AFK & Né Player", "WindUI")
local MainTab = Window:Tab("Main")
local SettingsTab = Window:Tab("Settings")

-- MainTab toggles
MainTab:Toggle("Auto AFK", function(state)
    autoAFKEnabled = state
    if state then autoAFKAvoidEnabled = false end
end)

MainTab:Toggle("Auto AFK + Né Player", function(state)
    autoAFKAvoidEnabled = state
    if state then autoAFKEnabled = false end
end)

MainTab:Toggle("Auto Né Player", function(state)
    autoAvoidEnabled = state
end)

-- Settings
SettingsTab:Slider("Cooldown (s)", 1, 10, cooldown, function(value)
    cooldown = value
end)

SettingsTab:Slider("Phạm vi di chuyển", 10, 100, moveRadius, function(value)
    moveRadius = value
end)

SettingsTab:Slider("Khoảng cách né", 5, 50, avoidDistance, function(value)
    avoidDistance = value
end)

SettingsTab:Slider("Độ lùi khi né", 5, 30, backDistance, function(value)
    backDistance = value
end)

SettingsTab:Textbox("Từ khóa phản hồi", table.concat(replyKeywords, ","), function(value)
    replyKeywords = {}
    for word in string.gmatch(value, "[^,]+") do
        table.insert(replyKeywords, word:lower())
    end
end)

SettingsTab:Textbox("Reply text", replyText, function(value)
    replyText = value
end)

-- Utility Functions
local function getRandomPosition(radius)
    local angle = math.random() * math.pi * 2
    local offset = Vector3.new(math.cos(angle), 0, math.sin(angle)) * radius
    return RootPart.Position + offset
end

local function isPlayerNearby(distance)
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local dist = (plr.Character.HumanoidRootPart.Position - RootPart.Position).Magnitude
            if dist <= distance then
                return plr
            end
        end
    end
    return nil
end

local function moveToPosition(pos)
    local Humanoid = Character:FindFirstChildOfClass("Humanoid")
    if Humanoid then
        Humanoid:MoveTo(pos)
        Humanoid.MoveToFinished:Wait()
    end
end

-- Auto AFK Thread
RunService.Heartbeat:Connect(function()
    if autoAFKEnabled or autoAFKAvoidEnabled then
        if Character:FindFirstChildOfClass("Humanoid").Sit then
            Character:FindFirstChildOfClass("Humanoid"):ChangeState(Enum.HumanoidStateType.Jumping)
        end

        local targetPos = getRandomPosition(moveRadius)

        -- Né người chơi nếu bật autoAFKAvoid
        if autoAFKAvoidEnabled then
            local plr = isPlayerNearby(avoidDistance)
            if plr then
                local dir = (RootPart.Position - plr.Character.HumanoidRootPart.Position).Unit
                targetPos = RootPart.Position + dir * backDistance
            end
        end

        moveToPosition(targetPos)
        task.wait(cooldown)
    end
end)

-- Auto Né Player Thread
RunService.Heartbeat:Connect(function()
    if autoAvoidEnabled then
        local plr = isPlayerNearby(avoidDistance)
        if plr then
            local dir = (RootPart.Position - plr.Character.HumanoidRootPart.Position).Unit
            local targetPos = RootPart.Position + dir * backDistance
            moveToPosition(targetPos)
        end
    end
end)

-- Auto reply to messages
Players.PlayerChatted:Connect(function(plr, msg)
    for _, keyword in ipairs(replyKeywords) do
        if string.find(string.lower(msg), keyword) then
            LocalPlayer:Chat(replyText)
            break
        end
    end
end)