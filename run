--// OrionLib
local OrionLib = loadstring(game:HttpGet('https://raw.githubusercontent.com/shlexware/Orion/main/source'))()

--// Config
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local Config = {
    Highlighters = false,
    Tracers = false,
    Distance = 500,
    Color = Color3.fromRGB(255,0,0),
    AutoJumpSit = true,
    AutoOffOnMove = true,
}

--// ESP Core
local function createHighlight(char)
    local highlight = Instance.new("Highlight")
    highlight.Adornee = char
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.FillColor = Config.Color
    highlight.OutlineColor = Color3.fromRGB(255,255,255)
    highlight.Parent = char
    return highlight
end

local function createTracer(player)
    local line = Drawing.new("Line")
    line.Color = Config.Color
    line.Thickness = 2
    line.Transparency = 1
    return line
end

local tracers = {}
local highlights = {}

RunService.RenderStepped:Connect(function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("Humanoid") then
        local humanoid = char:FindFirstChild("Humanoid")

        -- Auto Jump khi Sit
        if Config.AutoJumpSit and humanoid.Sit then
            humanoid.Jump = true
        end

        -- Tắt ESP khi người chơi di chuyển
        if Config.AutoOffOnMove and humanoid.MoveDirection.Magnitude > 0 then
            Config.Highlighters = false
            Config.Tracers = false
        end
    end

    for _,player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local root = player.Character.HumanoidRootPart
            local pos, visible = Camera:WorldToViewportPoint(root.Position)
            local distance = (root.Position - Camera.CFrame.Position).Magnitude

            -- Highlight
            if Config.Highlighters then
                if not highlights[player] then
                    highlights[player] = createHighlight(player.Character)
                end
                highlights[player].Enabled = distance <= Config.Distance
                highlights[player].FillColor = Config.Color
            elseif highlights[player] then
                highlights[player]:Destroy()
                highlights[player] = nil
            end

            -- Tracer
            if Config.Tracers then
                if not tracers[player] then
                    tracers[player] = createTracer(player)
                end
                if visible and distance <= Config.Distance then
                    tracers[player].From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
                    tracers[player].To = Vector2.new(pos.X,pos.Y)
                    tracers[player].Visible = true
                    tracers[player].Color = Config.Color
                else
                    tracers[player].Visible = false
                end
            elseif tracers[player] then
                tracers[player].Visible = false
            end
        end
    end
end)

--// OrionLib UI
local Window = OrionLib:MakeWindow({Name = "⚡ ESP Menu", HidePremium = false, SaveConfig = true, ConfigFolder = "ESP_Config"})

local ESPTab = Window:MakeTab({
    Name = "ESP",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

ESPTab:AddToggle({
    Name = "Highlight",
    Default = false,
    Callback = function(state) Config.Highlighters = state end
})

ESPTab:AddToggle({
    Name = "Tracer",
    Default = false,
    Callback = function(state) Config.Tracers = state end
})

ESPTab:AddSlider({
    Name = "ESP Distance",
    Min = 50,
    Max = 1000,
    Default = 500,
    Increment = 10,
    ValueName = "studs",
    Callback = function(value) Config.Distance = value end
})

ESPTab:AddColorpicker({
    Name = "ESP Color",
    Default = Color3.fromRGB(255,0,0),
    Callback = function(Value) Config.Color = Value end
})

-- Auto Jump & Auto Off UI
ESPTab:AddToggle({
    Name = "Auto Jump khi Sit",
    Default = true,
    Callback = function(state) Config.AutoJumpSit = state end
})

ESPTab:AddToggle({
    Name = "Tắt ESP khi di chuyển",
    Default = true,
    Callback = function(state) Config.AutoOffOnMove = state end
})

OrionLib:Init()